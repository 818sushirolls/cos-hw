apiVersion: apps/v1
kind: Deployment
metadata:
  name: mobileshoppingagg
  namespace: eshop-gateways
  labels:
    app.kubernetes.io/name: mobileshoppingagg
    app.kubernetes.io/part-of: eshop
    tier: gateway
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: mobileshoppingagg
  template:
    metadata:
      labels:
        app.kubernetes.io/name: mobileshoppingagg
        app.kubernetes.io/part-of: eshop
        tier: gateway
    spec:
      containers:
      - name: mobileshoppingagg
        image: ew8nought/mobileshoppingagg:latest
        imagePullPolicy: IfNotPresent
        ports:
        - containerPort: 80
        # Week 9: Liveness and Readiness Probes
        livenessProbe:
          httpGet:
            path: /hc
            port: 80
          initialDelaySeconds: 15
          periodSeconds: 10
          timeoutSeconds: 5
        readinessProbe:
          httpGet:
            path: /hc
            port: 80
          initialDelaySeconds: 5
          periodSeconds: 5
          timeoutSeconds: 3
        env:
        - name: ASPNETCORE_ENVIRONMENT
          value: Development
        - name: urls__basket
          value: http://basket-api.eshop-apis.svc.cluster.local
        - name: urls__catalog
          value: http://catalog-api.eshop-apis.svc.cluster.local
        - name: urls__orders
          value: http://ordering-api.eshop-apis.svc.cluster.local
        - name: urls__identity
          value: http://identity-api.eshop-apis.svc.cluster.local
        - name: urls__grpcBasket
          value: http://basket-api.eshop-apis.svc.cluster.local:81
        - name: urls__grpcCatalog
          value: http://catalog-api.eshop-apis.svc.cluster.local:81
        - name: urls__grpcOrdering
          value: http://ordering-api.eshop-apis.svc.cluster.local:81
        - name: CatalogUrlHC
          value: http://catalog-api.eshop-apis.svc.cluster.local/hc
        - name: OrderingUrlHC
          value: http://ordering-api.eshop-apis.svc.cluster.local/hc
        - name: IdentityUrlHC
          value: http://identity-api.eshop-apis.svc.cluster.local/hc
        - name: BasketUrlHC
          value: http://basket-api.eshop-apis.svc.cluster.local/hc
        - name: PaymentUrlHC
          value: http://payment-api.eshop-apis.svc.cluster.local/hc
        - name: IdentityUrlExternal
          value: http://localhost:5105
